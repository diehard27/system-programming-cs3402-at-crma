#summary การประยุกต์ใช้เชลล์สคริปต์ ๓
[CourseSchedule2555_2 กลับไปหน้าหลัก]-->[<a href="https://code.google.com/p/system-programming-cs3402-at-crma/wiki/CourseSchedule2555_2#ตารางเรียน_๒๕๕๕/๒">ตารางเรียน</a>]-->Next: [midtermReview ทบทวนก่อนสอบระหว่างภาค]
<table width=500>
<td>
<wiki:toc max_depth="3" />

=Trap Command=
คำสั่ง trap ใช้สำหรับกำหนดการกระทำคำสั่งใด ๆ เมื่อได้รับสัญญาณ (signal) การใช้งานทั่วไปจะใช้ในการให้สคริปต์ทำงานเมื่อได้รับการ interrupt จากสัญญาณใด รูปแบบของคำสั่ง trap คือ
{{{
trap command signal
}}}
สัญญาณ (signal) ที่เป็นที่ทราบ/ใช้กันมาก
||Signal(หมายเลข )|| คำอธิบาย||
||HUP (1) ||Hang up; ใช้ส่งไปให้ terminal นั้นเป็น offline หรือผู้ใช้ล็อกเอาท์ออกจากระบบ||
||INT (2) ||Interrupt; ส่งด้วยการกดคีย์ {{{<Ctrl-C>}}}||
||QUIT(3) ||Quit; ส่งสัญญาณด้วยการกดคีย์ {{{<Ctrl-\>}}}||
||ABRT(6) ||Abort; ส่งเมื่อการปัญหาในการรันโปรแกรม||
||ALRM(14)|| Alarm; ส่งเพื่อสื่อสารเกี่ยวกับการแจ้งเตือนการหมดเวลา (time-outs)||
||TERM(15)|| Terminate; ส่งเมื่อระบบจะหยุดการทำงาน (shutting down)||

==ตัวอย่าง==
ไฟล์ซอร์สโค้ดสามารถดูได้ที่ [https://code.google.com/p/system-programming-cs3402-at-crma/source/browse/trunk/shell/advanced/trap.sh trap.sh]
{{{
     1  #! /bin/bash
     2  # from Steeb WH, Linux, Shell Programming and Perl
     3  trap 'rm -f /tmp/my_tmp_file_$$' INT
     4  echo creating file /tmp/my_tmp_file_$$
     5  date > /tmp/my_tmp_file_$$
     6  echo "press interrupt (CRTL-C) to interrupt ... "
     7  while [ -f /tmp/my_tmp_file_$$ ]; do
     8    echo File exists
     9    sleep 1
    10  done
    11  echo The file no longer exists
    12  trap - INT
    13  echo creating file /tmp/my_tmp_file_$$
    14  date > /tmp/my_tmp_file_$$
    15  echo "press interrupt (CRTL-C) to interrupt ... "
    16  while [ -f /tmp/my_tmp_file_$$ ]; do
    17    echo File exists
    18    sleep 1
    19  done
    20  echo We never get here
    21  exit 0
}}}

=Google Search=

ไฟล์ต้นฉบับสามารถดูได้ที่ [https://code.google.com/p/system-programming-cs3402-at-crma/source/browse/trunk/shell/advanced/google.sh google.sh]
{{{
     1  #!/bin/bash
     2  # http://stackoverflow.com/questions/5506561/getting-the-urls-for-the-first-google-search-results-in-a-shell-script
     3  clear
     4  echo ""
     5  echo ".=========================================================."
     6  echo "|                                                         |"
     7  echo "|  COMMAND LINE GOOGLE SEARCH                             |"
     8  echo "|  ---------------------------------------------------    |"
     9  echo "|                                                         |"
    10  echo "|  Version: 1.0                                           |"
    11  echo "|  Developed by: Rishi Narang                             |"
    12  echo "|  Blog: www.wtfuzz.com                                   |"
    13  echo "|                                                         |"
    14  echo "|  Usage: ./gocmd.sh <search strings>                     |"
    15  echo "|  Example: ./gocmd.sh example and test                   |"
    16  echo "|                                                         |"
    17  echo ".=========================================================."
    18  echo ""
    19
    20  if [ -z $1 ]
    21  then
    22   echo "ERROR: No search string supplied."
    23   echo "USAGE: ./gocmd.sh <search srting>"
    24   echo ""
    25   echo -n "Anyways for now, supply the search string here: "
    26   read SEARCH
    27  else
    28   SEARCH=$@
    29  fi
    30
    31  URL="http://google.com/search?hl=en&safe=off&q="
    32  STRING=`echo $SEARCH | sed 's/ /%20/g'`
    33  URI="$URL%22$STRING%22"
    34
    35  lynx -dump $URI > gone.tmp
    36  sed 's/http/\^http/g' gone.tmp | tr -s "^" "\n" | grep http| sed 's/\ .*//g' > gtwo.tmp
    37  rm gone.tmp
    38  sed '/google.com/d' gtwo.tmp > urls
    39  rm gtwo.tmp
    40
    41  echo "SUCCESS: Extracted `wc -l urls` and listed them in '`pwd`/urls' file for reference."
    42  echo ""
    43  cat urls
    44  echo "
}}}