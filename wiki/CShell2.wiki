#summary C กับการติดต่อกับ Shell 2
<table width=500>
<td>
[CourseSchedule2555_2 กลับไปหน้าหลัก]-->[<a href="https://code.google.com/p/system-programming-cs3402-at-crma/wiki/CourseSchedule2555_2#ตารางเรียน_๒๕๕๕/๒">ตารางเรียน</a>]-->Next: [cSysProg C กับ System Programming]
<wiki:toc max_depth="3" />

== Permission ==
ภาษาซีมีฟังก์ชัน chmod และ fchmod ที่ใช้ในการกำหนด permission ให้ไฟล์ โดยมีรูปแบบดังนี้
{{{
#include <sys/types.h> 
#include <sys/stat.h> 
int chmod (const char *path, mode_t mode); 
int fchmod (int fd, mode_t mode);
}}}
ทั้ง chmod และ  fchmod สามารถใช้ set permission ได้เหมือนกัน ต่างกันตรงที่ chmod ใช้กับ absolute path name แต่ fchmod ใช้กับ file descriptor

flag สำหรับ chmod มีดังนี้
||Flag||Octal value||Purpose||
||S_ISUID||04000||Set user ID on execution||
||S_ISGID||02000||Set group ID on execution||
||S_ISVTX||01000||Sticky bit||
||S_IRUSR, S_IREAD||00400||Read by owner||
||S_IWUSR, S_IWRITE||00200||Write by owner||
||S_IXUSR, S_IEXEC||00100||Execute/search by owner||
||S_IRGRP||00040||Read by group||
||S_IWGRP||00020||Write by group||
||S_IXGRP||00010||Execute/search by group||
||S_IROTH||00004||Read by others||
||S_IWOTH||00002||write by others||
||S_IXOTH||00001||Execute/search by others||

ตัวอย่างของการใช้งาน chmod() แสดงได้ดังโค้ดด้านล่าง
{{{
int ret; 
/* 
* Set 'map.png' in the current directory to 
* owner-readable and -writable. This is the 
* same as 'chmod 600 ./map.png'. 
*/ 
ret = chmod ("./map.png", S_IRUSR | S_IWUSR); 
if (ret) 
perror ("chmod"); 
}}}

ตังอย่างของการใช้งาน fchmod() แสดงได้ดังโค้ดด้านล่าง
{{{
int ret; 
/* 
* Set the file behind 'fd' to owner-readable 
* and -writable. 
*/ 
ret = fchmod (fd, S_IRUSR | S_IWUSR); 
if (ret) 
perror ("fchmod"); 
}}}
ถ้า chmod() และ fchmod() ทำงานสำเร็จจะ return 0 แต่ถ้าไม่สำเร็จ จะ return -1 รายละเอียดของ error สามารถดูได้จากค่าของตัวแปร errno


== Reading the directory's content ==
ภาษาซี จะมอง content ของ directory เป็น stream ก่อนจะเริ่มอ่าน content จาก directory จะต้องทำการสร้าง directory stream เสียก่อน ซึ่งแทนด้วยการประการ Object ชื่อ *DIR* 
ภาษาซี ใช้ ตัวแปรโครงสร้าง (struct) dirent ซึ่งอยู่ใน library <dirent.h> ในการเก็บข้อมูลต่าง ๆ ของ content ใน directory โดยรายละเอียดของ struct dirent แสดงได้ตามโค้ดด้านล่าง
{{{
struct dirent { 
ino_t d_ino; /* inode number */ 
off_t d_off; /* offset to the next dirent */ 
unsigned short d_reclen; /* length of this record */ 
unsigned char d_type; /* type of file */ 
char d_name[256]; /* filename */ 
};
}}}
ในการอ่าน content ใน directory ด้วยภาษาซี จะใช้ฟังกชันหลัก ๆ 3 function ได้แก่ opendir(), readdir(), และ closedir() โดยรูปแบบการใช้งานของแต่ละฟังก์ชันแสดงได้ตามโค้ดด้านล่าง
รูปแบบการใช้งาน ฟังก์ชัน opendir()
{{{
#include <sys/types.h> 
#include <dirent.h> 
DIR * opendir (const char *name);
}}}

รูปแบบการใช้งานฟังก์ชัน readdir()
{{{
#include <sys/types.h> 
#include <dirent.h> 
struct dirent * readdir (DIR *dir);
}}}

รูปแบบการใช้งานฟังก์ชัน closedir()
{{{
#include <sys/types.h> 
#include <dirent.h> 
int closedir (DIR *dir);
}}}
ตัวอย่างนการเรียกใช้งานฟังก์ชันในการอ่าน content ใน directory แสดงได้ดังโค้ดด้านล่าง
{{{
 //Source code produced by Adri Jovin.J.J
  9 #include<stdio.h>
 10 #include<dirent.h>
 11 #include<stdlib.h>
 12 struct dirent *dptr;
 13 int main(int argc, char *argv[])
 14 {
 15         char buff[256];
 16         DIR *dirp;
 17         printf("\n\n Enter directory Name");
 18         scanf("%s",buff);
 19         if((dirp=opendir(buff))==NULL)
 20         {
 21                 printf("Error");
 22                 exit(1);
 23         }
 24         while(dptr=readdir(dirp))
 25         {
 26                 printf("%s\n",dptr->d_name);
 27         }
 28         closedir(dirp);
 29 }
}}}
== Memory Management ==

== Signal ==

== Time ==

== การประยุกต์ใช้ C ==


=References=
  # Wiil-Hans Steeb, et al, _Linux, Shell Programming and Perl_ [http://issc.uj.ac.za/downloads/linux.pdf  PDF]
  # Ananda Gunawardena, _Process Control_ [http://www.cs.cmu.edu/~guna/15-123S11/Lectures/Lecture25.pdf PDF]
  # March H. Scholl, _Process Control Subsystem_ [http://www.inf.uni-konstanz.de/dbis/teaching/ss09/os/L2.pdf PDF]
 
 
----
[CourseSchedule2555_2 กลับไปหน้าหลัก]-->[<a href="https://code.google.com/p/system-programming-cs3402-at-crma/wiki/CourseSchedule2555_2#ตารางเรียน_๒๕๕๕/๒">ตารางเรียน</a>]-->Next: [cSysProg C กับ System Programming]

[https://code.google.com/p/system-programming-cs3402-at-crma/w/edit/CShell2 Edit]