#summary ทบทวนภาษาซี (ต่อ)
<table width=500>
<td>
[CourseSchedule2555_2 กลับไปหน้าหลัก]-->[<a href="https://code.google.com/p/system-programming-cs3402-at-crma/wiki/CourseSchedule2555_2#ตารางเรียน_๒๕๕๕/๒">ตารางเรียน</a>]-->Next: [cSysProg C กับ System Programming]
<wiki:toc max_depth="3" />

==stdin,stdout,stderr==
ทั้ง stdin,stdout, และ stderr เป็น global variable ที่เป็นไฟล์หรือ stream ในภาษาซี โดยปกติเราจะทำการรับข้อมูลจาก stdin ก็คือคีย์บอร์ด และแสดงผลไปยัง stdout ซึ่งก็คือจอภาพ และเรายังสามารถเขียนโปรแกรมเก็บข้อผิดพลาดไปไว้ที่ stderr ได้อีกด้วย โดยใช้ฟังก์ชัน fprintf
fprintf เป็นฟังก์ชัน ที่ใช้แสดงผลคล้าย printf แต่แทนที่จะแสดงผลออกหน้าจอ จะไปเก็บผลไว้ที่ไฟล์แทน ตัวอย่างโค้ดด้านล่างเป็นการแสดงการใช้ fprintf ในการ redirect ข้อผิดพลาดไว้ใน stderr
{{{
  1 //stderr.c
  2 // by narong phoomsuk
  3 // usage : stderr.c string
  4 #include <stdio.h>
  5 #include <stdlib.h>
  6 int main(int argc,char* argv[]){
  7         if(argc != 2){
  8                 printf("usage %s string\n",argv[0]);
  9                 fprintf(stderr,"Invalid argument\n");
 10                 exit(1);
 11         }
 12         printf("string is %s",argv[1]);
 13         exit(0);
 14 }

}}}
จากโค้ดด้านบน บรรทัดที่ 6 จะมีการรับ argument ใส่ไปยังโปรแกรม บรรทัดที่ 7 จะตรวจสอบจำนวน argument รวมทั้งชื่อโปรแกรมว่ามีจำนวนมากกว่า 2 ตัวหรือไม่ ถ้ามีมากกว่า บรรทัดที่ 8 ให้แสดงข้อความ "usage <ชื่อโปรแกรม> string\n" ออกทางหน้าจอ หรือ stdout และบรรทัดที่ 9 จะให้แสดงข้อความ "Invalid argument\n" ออกทาง stderr โดยอาศัยฟังก์ชัน fprintf ช่วยแสดงข้อความไปยัง stderr บรรทัดที่ 10 จะเป็นการใช้ฟังก์ชัน exit() ซึ่งอยู่ใน library stdlib.h เพื่อหยุดการทำงานโปรแกรมและคืนค่า 1 ซึ่งหมายถึงจบโปรแกรมแบบมีข้อผิดพลาด
หากเราคอมไพล์โปรแกรมด้วยคำสั่ง "gcc -Wall -o stderr stderr.c" แล้วทดลองรันโปรแกรมปกติ ผลของการรันโปรแกรมจะเป็นดังนี้
{{{
$ ./stderr
usage ./stderr string
Invalid argument
}}}
จากผลการรันโปรแกรมจะเห็นว่าข้อความ Invalid argument ซึ่งในโค้ดต้องการให้ออกที่ stderr กลับออกที่ stdout แทน ทั้งนี้เพราะคำสั่งในการรันโปรแกรม ไม่ได้ระบุให้ stderr แสดงค่าไว้ที่ใด เพื่อให้เห็นการทำงานของ stderr อย่างชัดเจน เราสามารถปรับเปลี่ยนวิธีการรันโปรแกรมได้ดังนี้
{{{
$ ./stderr 2>err.txt
usage ./stderr string
}}}
จากผลการรันจะเห็นได้ว่าข้อความ Invalid argument ได้หายไป และเมื่อตรวจสอบที่ directory ปัจจุบัน ด้วยคำสั่ง "ls" จะพบไฟล์ "err.txt" ที่ถูกสร้างขึ้นมาใหม่ เมื่อเข้าไปดูเนื้อหาในไฟล์ err.txt ด้วยคำสั่ง {{{cat err.txt}}} จะพบข้อความ Invalid argument อยู่ ซึ่งสิ่งนี้แสดงให้เห็นถึงการทำงานของฟังก์ชัน fprintf ที่มีการส่งข้อมูลผ่าน stderr มาเก็บไว้ในไฟล์ err.txt
===แบบฝึกหัด===
จากการรันคำสั่งด้านล่างนี้ จะได้ผลลัพธ์เป็นอย่างไร
{{{
$ gcc -Wall -o stderr stderr.c
$ ./stderr > stdout.txt
}}}

==FILE==
ไฟล์คือที่เก็บข้อมูลต่าง ๆ ของคอมพิวเตอร์ ในระบบปฏิบัติการลินุกซ์และภาษาซี อาจรวมไปถึงอุปกรณ์และทรัพยากรต่าง ๆ ที่ต่ออยู่กับเครื่องคอมพิวเตอร์ เช่น คีย์บอร์ด จอภาพ
การติดต่อไฟล์จะต้องทำผ่าน stream โดยไฟล์แบ่งออกได้เป็นแบบต่าง ๆ ดังนี้
 * Text file เป็นไฟล์ของตัวอักษร การเก็บไฟล์จะเป็นเลขฐานสองตามรหัสตัวอักขระของ ASCII ไม่สามารถเก็บข้อมูลที่เป็นค่าตัวเลข จุดทศนิยม หรือเป็นในลักษณะของโครงสร้างได้ ปกติไฟล์พวกนี้เราจะสามารถเปิดอ่านและเข้าใจได้
 * Binary file เป็นไฟล์เก็บข้อมูลที่เป็นเลขฐานสอง ซึ่งสามารถเก็บข้อมูลที่เป็นค่าตัวเลข จุดทศนิยม หรือข้อมูลในลักษณะเชิงโครงสร้างได้ การอ่านเขียนข้อมูลจะเป็นในลักษณะของไบต์ต่อไบต์ เราไม่สามารถทำความเข้าใจข้อมูลที่อยู่ในไฟล์พวกนี้ได้
การประกาศตัวแปรเพื่อติดต่อกับไฟล์มีรูปแบบดังนี้
{{{
FILE *<ชื่อตัวแปร file pointer>;
}}}
เช่น
{{{
FILE *fp;
}}}
==ฟังก์ชันที่เกี่ยวข้องกับไฟล์==
===fopen===
เป็นฟังก์ชันที่ใช้ในการเปิดไฟล์ ซึ่งมีรูปแบบการใช้งานดังนี้
{{{
<ชื่อตัวแปร file pointer>=fopen("<absolute path name>","<โหมด>")
}}} 
โดยโหมดในการเปิดไฟล์มีดังนี้
||r||เปิดไฟล์เพื่ออ่าน||
||w||เปิดไฟล์เพื่อเขียน (จำเป็นต้องมีไฟล์อยู่ก่อน)||
||a ||เปิดไฟล์เพื่อเขียนต่อท้าย (จำเป็นต้องมีไฟล์อยู่ก่อน)||
||r+||เปิดไฟล์เพื่ออ่านและเขียนได้ โดยจะเริ่มเคอร์เซอร์ที่ต้นไฟล์||
||w+||เปิดไฟล์เพื่ออ่านและเขียน โดยจะเขียนทับไฟล์เดิม||
||a+||เปิดไฟล์เพื่ออ่านและเขียน โดยจะเขียนต่อท้ายไฟล์ถ้ามีไฟล์อยู่||

ในกรณีเปิดอ่านด้วยโหมด "r" และ "a" หากไม่มีไฟล์อยู่ก่อน ฟังก์ชันจะทำการคืนค่า null 
ตัวอย่างการใช้ fopen สามารถแสดงได้ดังโค้ดข้างล่างนี้
{{{
FILE *fp;
fp=fopen("test.text,"r");
}}} 
===fclose===
เป็นฟังก์ชันที่ใช้ในการปิดไฟล์ ซึ่งมีรูปแบบดังนี้
{{{
fclose(<ชื่อตัวแปร file pointer>);
}}} 

ตัวอย่างการใช้ fclose สามารถแสดงได้ดังโค้ดข้างล่างนี้
{{{
fclose(fp);
}}} 

===feof===
ใช้ในการครวจสอบเคอร์เซอร์ที่ชี้อยู่ในไฟล์ว่าถึงจุดสิ้นสุดไฟล์ (Enf-of-File, EOF) หรือยัง ถ้าถึงแล้วจะ return ค่าเป็น true มีรูปแบบการใช้งานดังนี้
{{{
feof(<ชื่อตัวแปร file pointer>);
}}}
ตัวอย่างการใช้งานฟังก์ชัน feof สามารถแสดงได้ดังโค้ดข้างล่างนี้
{{{
feof(fp);
}}}
ในกรณีที่ฟังก์ชัน fclose ไม่สามารถปิดไฟล์ได้ จะทำการ return ค่าเป็น EOF

===fscanf===
เป็นฟังก์ชันที่ใช้ในการอ่านข้อมูลในไฟล์ มีรูปแบบดังนี้
{{{
fscanf(<ชื่อ file Pointer>,"<format>",<ชื่อตัวแปร>);
}}}

{{{
  1 //file1.c
  2 // by narong phoomsuk
  3 #include <stdio.h>
  4 #include <stdlib.h>
  5
  6 int main(int argc,char* argv[]){
  7         FILE *fp;
  8         char username[9];
  9         if((fp=fopen("test.txt","r"))==NULL)
 10         {
 11                 printf("\nError opening file test.txt\n");
 12                 exit(1);
 13         }
 14         printf("file opened\n");
 15         while(!feof(fp)){
 16                 fscanf(fp,"%s",username);
 17                 printf("user is %s\n",username);
 18         }
 19
 20         if(fclose(fp)==EOF)
 21         {
 22                 printf("\nError closing file test.txt\n");
 23                 exit(2);
 24         }
 25         printf("file closed\n");
 26         exit(0);
 27 }

}}}
=References=
  # Wiil-Hans Steeb, et al, _Linux, Shell Programming and Perl_ (Chapter 2 File I/O) [http://issc.uj.ac.za/downloads/linux.pdf  PDF]
----
[CourseSchedule2555_2 กลับไปหน้าหลัก]-->[<a href="https://code.google.com/p/system-programming-cs3402-at-crma/wiki/CourseSchedule2555_2#ตารางเรียน_๒๕๕๕/๒">ตารางเรียน</a>]-->Next: [cSysProg C กับ System Programming]

[https://code.google.com/p/system-programming-cs3402-at-crma/w/edit/cReview2 Edit]